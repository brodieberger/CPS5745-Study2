<html>
  <body>
    <img
      id="scream"
      src="img_the_scream.jpg"
      alt="The Scream"
      style="display: none"
    />
    <h1>whatever</h1>

    <canvas
      id="myCanvas"
      width="250"
      height="300"
      onmousemove="showCoords(event)"
      onmousedown="mouseDown(event)"
      onmouseup="mouseUp(event)"
    >
    </canvas>
    <p id="demo">Coordinates:</p>
    <p id="rgb">RGB:</p>
    <p id="counts">RGB Pixel Counts:</p>

    <div>
      <canvas id="myChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      function renderImage() {
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        var img = document.getElementById("scream");

        ctx.canvas.width = img.width;
        ctx.canvas.height = img.height;
        ctx.drawImage(img, 0, 0);
      }

      function showCoords(event) {
        // Coords
        let x = event.offsetX;
        let y = event.offsetY;
        let text = "X coords: " + x + ", Y coords: " + y;
        document.getElementById("demo").innerHTML = text;

        // Draw
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        if (isMouseDown) {
          ctx.clearRect(0, 0, c.width, c.height);
          renderImage();
          x = event.offsetX - firstX;
          y = event.offsetY - firstY;
          ctx.rect(firstX, firstY, x, y);
          ctx.stroke();
        }

        // RGB
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");

        var pixelData = ctx.getImageData(x, y, 1, 1).data;

        var r = pixelData[0];
        var g = pixelData[1];
        var b = pixelData[2];

        var rgbText = "RGB: (" + r + ", " + g + ", " + b + ")";
        document.getElementById("rgb").innerHTML = rgbText;
      }

      let isMouseDown = false;
      let firstX = 0;
      let firstY = 0;
      function mouseDown(event) {
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        ctx.clearRect(0, 0, c.width, c.height);
        renderImage();
        firstX = event.offsetX;
        firstY = event.offsetY;
        isMouseDown = true;
      }

      function mouseUp(event) {
        isMouseDown = false;
        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");
        const imageData = ctx.getImageData(
          firstX,
          firstY,
          event.offsetX - firstX,
          event.offsetY - firstY
        );
        processData(imageData);
      }

      function processData(imageData) {
        var redTotal = 0;
        var greenTotal = 0;
        var blueTotal = 0;
        for (let i = 0; i < imageData.data.length; i += 4) {
          redTotal += imageData.data[i];
          greenTotal += imageData.data[i + 1];
          blueTotal += imageData.data[i + 2];
        }

        var countText =
          "RGB Pixel Counts: (" +
          redTotal +
          ", " +
          greenTotal +
          ", " +
          blueTotal +
          ")";
        document.getElementById("counts").innerHTML = countText;
        createChart(redTotal, greenTotal, blueTotal);
      }

      
      function createChart(redTotal, greenTotal, blueTotal) {
        const ctx = document.getElementById("myChart");
        new Chart(ctx, {
          type: "pie",
          data: {
            labels: ["Red", "Green", "Blue"],
            datasets: [
              {
                label: "# of pixels",
                data: [redTotal, greenTotal, blueTotal],
                backgroundColor: ["red", "green", "blue"],
                borderWidth: 1,
              },
            ],
          },
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      window.onload = renderImage();
    </script>
  </body>
</html>
